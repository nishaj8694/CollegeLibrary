<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <title>Document</title>
    <style>
      .cardTexted{
        background-color: rgb(255, 255, 255,0.7);
        padding-inline: 5px;
        border-radius: 3px;
        box-shadow: rgba(17, 12, 46, 0.15) 0px 48px 100px 0px;;

      }
      .cardContent{
        background-color: rgba(34, 33, 33, 0.5);
        width: 100%;
        height: 70%;
        position: absolute;
        bottom: 30%;
        border-top-left-radius:5px ;
        border-top-right-radius:5px ;
        transform:
              perspective(350px)
              translate3d(0px, 0px, -250px)
              rotateX(90deg)
              scale(0.9, 0.9);
        opacity: 0; 
        transition: opacity,transform 0.8s ease-in-out;
      }
      .cardContent>li>p{
        color: whitesmoke;

      }
      .card:hover .cardContent{
        transform: translate3d(0px, 0px, -50px);
        opacity: 1;
      }
    </style>  
</head>
<body style="margin: 0; padding: 0; height: 100vh; width: 100vw;">
  <script>
    
    function clickSubcription(bok){
      window.location.href =`/book/?id=${bok}`;
    }

  
    function subscribe(){
      var dm = document.querySelector('select[name="dep"]').value;
      var sub = document.querySelector('select[name="subs"]').value;
      var st = document.querySelector('select[name="sort"]').value;
      
      // window.location.href =`/?department=${dm}&sortBy=${sub}`;
      fetch(`/index?department=${dm}&bookstatus=${sub}&sortBy=${st}`)
      .then(response => response.json())
      .then(data =>{
        console.log(data)
        const datadiv=document.getElementById('dataContent');
        datadiv.innerHTML='';
        data.forEach(book => {
          const card=document.createElement('div');
          card.className='card';
          card.style='width:18rem';
          let binary = '';

          card.innerHTML=`
              <img src="${book.Image}"            
                class="card-img-top" height="250px" alt="${book.Image}">
             <div class="card-body position-absolute">
               <h5 class="card-title cardTexted">${book.Book}</h5>
             </div>
             <ul class="list-group list-group-flush cardContent">
               <li class="list-group-item bg-transparent">
                 <p><b>Auther</b> ${book.Auther}</p>
                 <p><b>Pages</b> ${book.Page}</p>
                 <p><b>Department</b> ${book.Department}</p>
               </li>
             </ul>
             <div class="card-body text-center p-0 py-1 d-flex flex-column justify-content-center align-items-center"
                   style="height:100px;">
               <h5 class="m-0 p-0">${book.Book}</h5>
               ${book.Subscribe ? 
               '<p class="m-0 p-0  px-2 my-1 w-50">unavailable</p>' :
               '<p class="m-0 p-0 btn btn-success px-2 my-1 w-50" onclick="clickSubcription(\'' + book.id + '\')" >Subscribe</p>'}
             </div>`;
          datadiv.appendChild(card);
        });
       }) 
      .catch(console.log('error'))
    }
  </script> 
  <div class="container-fluid">
    <nav class="navbar navbar-expand-lg">
      <div class="container-fluid">
        <a class="navbar-brand" href="/">Home</a>
        
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        
        <div class="collapse navbar-collapse justify-content-end" id="navbarSupportedContent">
          <ul class="navbar-nav">
            <% if (admin) { %>
            <li class="nav-item">
              <a class="nav-link" aria-current="page" href="/dashboard">dashboard</a>
            </li>
            <% } %>

            
            <!-- <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                Dropdown
              </a>
              <ul class="dropdown-menu">
                <li><a class="dropdown-item" href="#">Action</a></li>
                <li><a class="dropdown-item" href="#">Another action</a></li>
                <li><hr class="dropdown-divider"></li>
                <li><a class="dropdown-item" href="#">Something else here</a></li>
              </ul>
            </li> -->
            <li class="nav-item">
              <% if (user) { %>
                <a class="nav-link" aria-current="page" href="/logout">Logout</a>
              <% } else { %>
                <a class="nav-link" aria-current="page" href="/login">Login</a>
              <% } %>
            </li>
            <li class="nav-item">
              <form class="d-flex" style="position: relative;">
                <input class="form-control me-2" type="search" placeholder="Search" aria-label="Search">
                <button class="btn btn-success position-absolute p-1" 
                  style="right:11px; top: 2px; border: none;"  type="submit">Search</button>
              </form>
            </li>
          </ul>
        </div>
      </div>
    </nav>
      <div class="container-fluid d-flex align-items-center flex-wrap  gap-3 mt-2 ">
        <div class="container-fluid border border-2 rounded-1 d-flex justify-content-end 
          align-items-center gap-1 flex-wrap py-2">
          <label  style="margin-right: auto;">Filter</label>
          <label>
            <select class="border border-2 rounded-1 px-2" name="dep"
             onchange="subscribe()">
              <option value="" disabled selected>Department</option>
              <option value="general">General</option>
              <option value="commerce">Commerce</option>
              <option value="science">Science</option>
              <option value="">Clear</option>

            </select>
          </label>
          <!-- <label>
            <select class="border border-2 rounded-1 px-2">
              <option value="" disabled selected>Journey</option>
              <option value="1">Romance</option>
              <option value="">Mystery & thriller</option>
              <option value="">Science fiction & fantasy</option>
              <option value="">Horror</option>
              <option value="">Historical fiction</option>
              <option value="">Biography & memoir</option>
              <option value="">Self-help</option>
              <option value="">Wellness & health</option>
              <option value="">True crime</option>
              <option value="">Travel</option>
            </select>
          </label>  -->
          <label>
            <select class="border border-2 rounded-1 px-2" name="subs" onchange="subscribe()">
              <option value="" disabled selected>Book status</option>
              <option value=false>Subscribe</option>
              <option value=true>Non Subscribe</option>
              <option value="">Clear</option>

            </select>
          </label>
          <label>
            <select class="border border-2 rounded-1 px-2" name="sort" onchange="subscribe()">
              <option value="" disabled selected>sort by</option>
              <option value='decr'>Decrement</option>
              <option value='incr'>Increment</option>
              <option value='name'>Name</option>
              <option value="">Clear</option>
            </select>
          </label>     
        </div>
        <div class="d-flex align-items-center flex-wrap  gap-1 mt-2 w-100" id="dataContent">
          <% data.forEach(book => { %>
            <div class="card" style="width: 18rem;">
              <img src="<%= book.Image %>"
               alt="Book Image" class="card-img-top" height="250px" > 
                 <!-- <div class="card-body position-absolute">
                   <h5 class="card-title cardTexted"><%= book.Book %></h5>
                 </div> -->
                 <ul class="list-group list-group-flush cardContent">
                   <li class="list-group-item bg-transparent">
                     <p><b>Auther</b> <%= book.Auther %></p>
                     <p><b>Pages</b> <%= book.Page %></p>
                     <p><b>Department</b> <%= book.Department %></p>
                   </li>
                 </ul>
                 <div class="card-body text-center  p-0 py-1 d-flex flex-column justify-content-center align-items-center"
                   style="height:100px;">
                   <h5 class="m-0 p-0"><%= book.Book %></h5>
                   <!-- <p><%= book.Subscribe === false ? "Subscribe" : "Not available" %></p> -->
                   <% if (book.Subscribe ===false ){ %>
                      <p class="m-0 p-0 btn btn-success px-2 my-1 w-50 " onclick="clickSubcription('<%= book.id %>')">Subscribe</p>
                   <% } else{ %>
                      <p class="m-0 p-0  px-2 my-1 w-50">unavailable</p> 
                   <% } %>
                 </div>
               </div>  
             <% }); %>
        </div>  
      </div> 
   </div>

</body>
</html>